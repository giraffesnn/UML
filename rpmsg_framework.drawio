<mxfile host="app.diagrams.net" modified="2020-07-24T05:54:28.714Z" agent="5.0 (Windows)" etag="8nYjCBckipRky3WzFbc8" version="13.4.9" type="github">
  <diagram id="En-_3escWLUhismutuOt" name="第 1 页">
    <mxGraphModel dx="1483" dy="781" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="10000" pageHeight="8000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-63" value="include/linux/rpmsg.h" style="swimlane;fontStyle=0;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="1790" height="320" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-51" value="struct rpmsg_endpoint" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF00FF;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="1000" y="70" width="240" height="208" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-52" value="struct rpmsg_device *rpdev;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="26" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-53" value="struct kref refcount;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="52" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-54" value="rpmsg_rx_cb_t cb;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="78" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-55" value="struct mutex cb_lock;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="104" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-56" value="u32 addr;      // local rpmsg address" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="130" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-57" value="void *priv;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="156" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-58" value="const struct rpmsg_endpoint_ops *ops;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#EA6B66;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry y="182" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-39" value="struct rpmsg_device" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF00FF;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="520" y="70" width="260" height="208" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-40" value="struct device dev;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="26" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-41" value="struct rpmsg_device_id id;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#EA6B66;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="52" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-42" value="u32 src;      // local address" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="78" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-43" value="u32 dst;      // destination address" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="104" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-44" value="struct rpmsg_endpoint *ept;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#EA6B66;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="130" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-45" value="bool announce;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="156" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-46" value="const struct rpmsg_device_ops *ops;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#EA6B66;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-39">
          <mxGeometry y="182" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-34" value="struct rpmsg_driver" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF00FF;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="30" y="70" width="330" height="156" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-35" value="struct device_driver drv;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-34">
          <mxGeometry y="26" width="330" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-36" value="const struct rpmsg_device_id *id_table;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#EA6B66;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-34">
          <mxGeometry y="52" width="330" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-37" value="int (*probe)(struct rpmsg_device *dev);" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-34">
          <mxGeometry y="78" width="330" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-38" value="void (*remove)(struct rpmsg_device *dev);" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-34">
          <mxGeometry y="104" width="330" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-67" value="int (*callback)(struct rpmsg_device *, void *, int, void *, u32);" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-34">
          <mxGeometry y="130" width="330" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-71" value="" style="endArrow=block;startArrow=block;endFill=1;startFill=1;html=1;fontFamily=Lucida Console;fontColor=#EA6B66;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-63" source="Eo5dm-Wqf6loFh02fLz2-36" target="Eo5dm-Wqf6loFh02fLz2-41">
          <mxGeometry width="160" relative="1" as="geometry">
            <mxPoint x="370" y="130" as="sourcePoint" />
            <mxPoint x="530" y="130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-73" value="&lt;div&gt;&lt;div&gt;&lt;font color=&quot;#FF00FF&quot;&gt;&lt;span style=&quot;background-color: rgb(255 , 255 , 255)&quot;&gt;rpmsg_dev_match&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#EA6B66;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="380" y="110" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#000000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-63" source="Eo5dm-Wqf6loFh02fLz2-44" target="Eo5dm-Wqf6loFh02fLz2-51">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="880" y="30" as="targetPoint" />
            <Array as="points">
              <mxPoint x="850" y="213" />
              <mxPoint x="850" y="30" />
              <mxPoint x="1120" y="30" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-150" value="&lt;div&gt;rpmsg_driver和&lt;/div&gt;&lt;div&gt;rpmsg_device匹配时，&lt;/div&gt;&lt;div&gt;比较的是.name&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;id_table.name和 &lt;br&gt;&lt;/div&gt;&lt;div&gt;id.name做 strncmp&lt;br&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fontFamily=Lucida Console;fontColor=#333333;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="360" y="186" width="140" height="92" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-229" value="if set, rpmsg will announce the creation/removal of this channel" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fontFamily=Lucida Console;fontColor=#333333;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="810" y="166" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-230" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-63" source="Eo5dm-Wqf6loFh02fLz2-45" target="Eo5dm-Wqf6loFh02fLz2-229">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="910" y="239" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-231" value="&amp;nbsp;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* @rpdev: rpmsg channel device&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* @refcount: when this drops to zero, the ept is deallocated&lt;/font&gt;&lt;/div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* @cb: rx callback handler&lt;br&gt;&amp;nbsp;* @cb_lock: must be taken before accessing/changing @cb&lt;br&gt;&amp;nbsp;* @&lt;font color=&quot;#FF0080&quot;&gt;addr: local rpmsg address&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* @priv: private data for the driver&#39;s use&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;&amp;nbsp; 从本质上来讲，rpmsg endpoint代表了rpmsg bus上的一个listener，因为它&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;将rpmsg address和rx callback handler绑定在一起。&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;&amp;nbsp; 简单的rpmsg driver驱动不应该直接使用这个结构体，因为事情是这样：每一个&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;rpmsg driver在注册到rpmsg bus时，都会提供一个rx callback，当驱动被probe时，该callback会被绑定到它的rpmsg address。当相关的inbound messages到达时（即消息的dst address等于rpmsg channel的src address），驱动程序的处理程序被调用来处理它。&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;&amp;nbsp; 更复杂的rpmsg driver，如果需要分配额外的rpmsg地址，并将它们绑定到不同的rx callback，就必须自己显示地创建额外的endpoint（参见rpmsg_create_ept()）&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fontFamily=Lucida Console;fontColor=#333333;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-63">
          <mxGeometry x="1290" y="29" width="470" height="290" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-232" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.455;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-63" source="Eo5dm-Wqf6loFh02fLz2-54" target="Eo5dm-Wqf6loFh02fLz2-231">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-103" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#000000;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Eo5dm-Wqf6loFh02fLz2-46" target="Eo5dm-Wqf6loFh02fLz2-85">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="680" y="460" as="targetPoint" />
            <Array as="points">
              <mxPoint x="680" y="350" />
              <mxPoint x="680" y="350" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-76" value="drivers/rpmsg/rpmsg_internal.h" style="swimlane;fontStyle=0;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="440" y="400" width="880" height="320" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-105" value="struct rpmsg_endpoint_ops" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF00FF;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-76">
          <mxGeometry x="600" y="80" width="240" height="234" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-106" value="destroy_ept()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="26" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-107" value="send()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="52" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-108" value="sendto()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="78" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-114" value="send_offchannel()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="104" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-125" value="trysend()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="130" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-126" value="trysendto()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="156" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-127" value="trysend_offchannel()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="182" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-128" value="poll()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry y="208" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-85" value="struct rpmsg_device_ops" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF00FF;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-76">
          <mxGeometry x="120" y="80" width="240" height="104" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-86" value="create_ept()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-85">
          <mxGeometry y="26" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-87" value="announce_create()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-85">
          <mxGeometry y="52" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-88" value="announce_destro()" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-85">
          <mxGeometry y="78" width="240" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-129" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#000000;" edge="1" parent="1" source="Eo5dm-Wqf6loFh02fLz2-58" target="Eo5dm-Wqf6loFh02fLz2-105">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="960" y="449.9999999999999" as="targetPoint" />
            <Array as="points">
              <mxPoint x="960" y="305" />
              <mxPoint x="960" y="440" />
              <mxPoint x="1160" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-131" value="samples/renesas_taurus_client/taurus_client_sample.c" style="swimlane;fontStyle=0;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="880" y="1260" width="490" height="570" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-178" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=-0.009;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontColor=#000000;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-131" source="Eo5dm-Wqf6loFh02fLz2-175" target="Eo5dm-Wqf6loFh02fLz2-145">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-175" value="module_rpmsg_driver(taurus_sample_client);" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-131">
          <mxGeometry x="85" y="40" width="320" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-145" value="struct rpmsg_driver taurus_sample_client" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-131">
          <mxGeometry x="115" y="100" width="260" height="156" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-146" value=".drv.name  = KBUILD_MODNAME," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-145">
          <mxGeometry y="26" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-174" value=".id_table       = taurus_driver_sample_id_table," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-145">
          <mxGeometry y="52" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-147" value=".probe     = taurus_sample_probe," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-145">
          <mxGeometry y="78" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-148" value=".callback  = taurus_sample_cb," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-145">
          <mxGeometry y="104" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-149" value=".remove        = taurus_sample_remove," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-145">
          <mxGeometry y="130" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-179" value="&lt;div align=&quot;left&quot;&gt;static struct rpmsg_device_id taurus_driver_sample_id_table[] = {&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; { &lt;font color=&quot;#FF0080&quot;&gt;.name = &quot;taurus-virtdev&quot;&lt;/font&gt; },&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; { },&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;};&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-131">
          <mxGeometry x="40" y="290" width="360" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-180" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontColor=#000000;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-131" source="Eo5dm-Wqf6loFh02fLz2-174" target="Eo5dm-Wqf6loFh02fLz2-179">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-151" value="&lt;div&gt;&lt;font size=&quot;1&quot; color=&quot;#000000&quot;&gt;&lt;b style=&quot;font-size: 16px&quot;&gt;How to write rpmsg drivers?&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size=&quot;1&quot; color=&quot;#000000&quot;&gt;&lt;b style=&quot;font-size: 16px&quot;&gt;---------------------------&lt;br&gt;&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font size=&quot;1&quot; color=&quot;#000000&quot;&gt;&lt;b style=&quot;font-size: 16px&quot;&gt;&lt;/b&gt;&lt;/font&gt;Documentation/rpmsg.txt&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;samples/rpmsg/rpmsg_client_sample.c&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;samples/renesas_taurus_client/taurus_client_sample.c&lt;br&gt;&lt;/div&gt;&lt;div&gt;drivers/gpu/drm/rcar-rvgc/rcar_rvgc_drv.c&lt;/div&gt;&lt;div&gt;drivers/net/can/rcar-taurus/rcar_taurus_can.c&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255 , 255 , 0)&quot;&gt;TODO:&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;sound/soc/sh/rcar-taurus/*&lt;/div&gt;&lt;div&gt;-------------------------------------&lt;/div&gt;&lt;div&gt;构造一个rpmsg_driver结构体&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;注册: &lt;font color=&quot;#0000FF&quot;&gt;&lt;i&gt;register an rpmsg driver with the rpmsg bus.&lt;/i&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;module_rpmsg_driver(&lt;font color=&quot;#EA6B66&quot;&gt;&lt;i&gt;rpmsg_driver&lt;/i&gt;&lt;/font&gt;)&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; register_rpmsg_driver(rpmsg_driver)&lt;br&gt;&lt;/div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; __register_rpmsg_driver(rpmsg_driver, THIS_MODULE)&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fontFamily=Lucida Console;fontColor=#333333;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="200" y="950" width="480" height="430" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-154" value="samples/rpmsg/rpmsg_client_sample.c" style="swimlane;fontStyle=0;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="190" y="1390" width="570" height="730" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-163" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontColor=#000000;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-154" source="Eo5dm-Wqf6loFh02fLz2-160" target="Eo5dm-Wqf6loFh02fLz2-155">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-160" value="module_rpmsg_driver(rpmsg_sample_client);" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-154">
          <mxGeometry x="60" y="50" width="320" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-155" value="struct rpmsg_driver taurus_sample_client" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-154">
          <mxGeometry x="90" y="100" width="260" height="156" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-156" value=".drv.name  = KBUILD_MODNAME," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-155">
          <mxGeometry y="26" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-165" value=".id_table       = rpmsg_driver_sample_id_table," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-155">
          <mxGeometry y="52" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-157" value=".probe     = taurus_sample_probe," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-155">
          <mxGeometry y="78" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-158" value=".callback  = taurus_sample_cb," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-155">
          <mxGeometry y="104" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-159" value=".remove        = taurus_sample_remove," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-155">
          <mxGeometry y="130" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-164" value="&lt;div align=&quot;left&quot;&gt;static struct rpmsg_device_id rpmsg_driver_sample_id_table[] = {&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; { &lt;font color=&quot;#FF0080&quot;&gt;.name = &quot;rpmsg-client-sample&quot;&lt;/font&gt; },&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; { },&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;};&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-154">
          <mxGeometry x="40" y="280" width="360" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-166" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontColor=#000000;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-154" source="Eo5dm-Wqf6loFh02fLz2-165" target="Eo5dm-Wqf6loFh02fLz2-164">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="20" y="165" />
              <mxPoint x="20" y="315" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-167" value="&lt;div&gt;int rpmsg_sample_probe(struct rpmsg_device *rpdev) &lt;br&gt;&lt;/div&gt;&lt;div&gt;{&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; /* send a message to our remote processor */&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_send(rpdev-&amp;gt;ept, MSG, strlen(MSG));&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-154">
          <mxGeometry x="60" y="390" width="360" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-168" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#000000;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-154" source="Eo5dm-Wqf6loFh02fLz2-157" target="Eo5dm-Wqf6loFh02fLz2-167">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="490" y="455" as="targetPoint" />
            <Array as="points">
              <mxPoint x="540" y="191" />
              <mxPoint x="540" y="445" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-171" value="#define MSG&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &quot;hello world!&quot;&lt;br&gt;#define MSG_LIMIT&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 100&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-154">
          <mxGeometry x="70" y="670" width="280" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-172" value="&lt;div&gt;int rpmsg_sample_probe(struct rpmsg_device *rpdev) &lt;br&gt;&lt;/div&gt;&lt;div&gt;{&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; /* send a new message now */&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_send(rpdev-&amp;gt;ept, MSG, strlen(MSG));&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ...&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-154">
          <mxGeometry x="60" y="520" width="360" height="110" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-173" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#000000;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-154" source="Eo5dm-Wqf6loFh02fLz2-158" target="Eo5dm-Wqf6loFh02fLz2-172">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="500" y="550" as="targetPoint" />
            <Array as="points">
              <mxPoint x="480" y="217" />
              <mxPoint x="480" y="575" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-182" value="drivers/rpmsg/rpmsg_core.c" style="swimlane;fontStyle=0;fontFamily=Lucida Console;" vertex="1" parent="1">
          <mxGeometry x="1810" y="970" width="1630" height="2380" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-195" value="&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;i&gt;/* register an rpmsg driver with the rpmsg bus */&lt;/i&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;int &lt;font color=&quot;#FF0080&quot;&gt;__register_rpmsg_driver&lt;/font&gt;(struct rpmsg_driver *rpdrv, struct module *owner)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpdrv-&amp;gt;drv.bus = &amp;amp;&lt;font color=&quot;#FF0080&quot;&gt;rpmsg_bus&lt;/font&gt;;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpdrv-&amp;gt;drv.owner = owner;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return driver_register(&amp;amp;rpdrv-&amp;gt;drv);&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="30" y="30" width="600" height="100" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-197" value="int &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_register_device&lt;/font&gt;(struct rpmsg_device *rpdev)&lt;br&gt;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct device *dev = &amp;amp;rpdev-&amp;gt;dev;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int ret;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; dev_set_name(&amp;amp;rpdev-&amp;gt;dev, &quot;%s.%s.%d.%d&quot;, dev_name(dev-&amp;gt;parent),&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpdev-&amp;gt;id.name, rpdev-&amp;gt;src, rpdev-&amp;gt;dst);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpdev-&amp;gt;dev.bus = &amp;amp;&lt;font color=&quot;#FF0080&quot;&gt;rpmsg_bus&lt;/font&gt;;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ret = device_register(&amp;amp;rpdev-&amp;gt;dev);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (ret) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; dev_err(dev, &quot;device_register failed: %d\n&quot;, ret);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; put_device(&amp;amp;rpdev-&amp;gt;dev);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return ret;&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="30" y="160" width="520" height="260" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-199" value="struct bus_type rpmsg_bus" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#dae8fc;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;strokeColor=#6c8ebf;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="130" y="650" width="260" height="182" as="geometry">
            <mxRectangle x="150" y="130" width="100" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-200" value=".name           = &quot;rpmsg&quot;," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-199">
          <mxGeometry y="26" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-201" value=".match          = rpmsg_dev_match," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-199">
          <mxGeometry y="52" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-202" value=".dev_groups     = rpmsg_dev_groups," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-199">
          <mxGeometry y="78" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-211" value=".uevent         = rpmsg_uevent," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-199">
          <mxGeometry y="104" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-203" value=".probe          = rpmsg_dev_probe," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2;fontColor=#FF0080;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-199">
          <mxGeometry y="130" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-204" value=".remove         = rpmsg_dev_remove," style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontStyle=2" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-199">
          <mxGeometry y="156" width="260" height="26" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-212" value="&lt;div align=&quot;left&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;/* match rpmsg channel and rpmsg driver */&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;static int &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_dev_match&lt;/font&gt;(struct device *dev, struct device_driver *drv)&lt;br&gt;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_device&lt;/font&gt; *rpdev = to_rpmsg_device(dev);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_driver&lt;/font&gt; *rpdrv = to_rpmsg_driver(drv);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; const struct rpmsg_device_id *ids = rpdrv-&amp;gt;id_table;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; unsigned int i;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (rpdev-&amp;gt;driver_override)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return !strcmp(rpdev-&amp;gt;driver_override, drv-&amp;gt;name);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (ids)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; for (i = 0; ids[i].name[0]; i++)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (&lt;font color=&quot;#FF0080&quot;&gt;rpmsg_id_match&lt;/font&gt;(rpdev, &amp;amp;ids[i]))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return 1;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return of_driver_match_device(dev, drv);&lt;br&gt;}&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;/* rpmsg devices and drivers are matched using the service name */&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;font color=&quot;#000000&quot;&gt;static inline int rpmsg_id_match(const struct rpmsg_device *rpdev,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; const struct rpmsg_device_id *id)&lt;br&gt;{&lt;br&gt;&amp;nbsp; return strncmp(&lt;font color=&quot;#FF0080&quot;&gt;id-&amp;gt;name&lt;/font&gt;, &lt;font color=&quot;#FF0080&quot;&gt;rpdev-&amp;gt;id.name&lt;/font&gt;, RPMSG_NAME_SIZE) == 0; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;}&lt;/font&gt;&lt;br&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="60" y="870" width="560" height="380" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-213" value="static int __init rpmsg_init(void)&lt;br&gt;{&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int ret;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ret = &lt;font color=&quot;#FF0080&quot;&gt;bus_register(&amp;amp;rpmsg_bus);&lt;/font&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (ret)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; pr_err(&quot;failed to register rpmsg bus: %d\n&quot;, ret);&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return ret;&lt;br&gt;}&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="30" y="450" width="500" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-228" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-182" source="Eo5dm-Wqf6loFh02fLz2-221" target="Eo5dm-Wqf6loFh02fLz2-224">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-221" value="&lt;font color=&quot;#0000FF&quot;&gt;/*&lt;br&gt;&amp;nbsp;* when an rpmsg driver is probed with a channel, we seamlessly create&lt;br&gt;&amp;nbsp;* it an endpoint, binding its rx callback to a unique local rpmsg&lt;br&gt;&amp;nbsp;* address.&lt;br&gt;&amp;nbsp;*&lt;br&gt;&amp;nbsp;* if we need to, we also announce about this channel to the remote&lt;br&gt;&amp;nbsp;* processor (needed in case the driver is exposing an rpmsg service).&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;*/&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;/* rpmsg driver和rpmsg device匹配后，probe函数中，&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 创建一个&lt;/font&gt;&lt;font color=&quot;#0000FF&quot;&gt;rpmsg_endpoint，并绑定它的rx回调函数到一个唯一的local rpmsg address.&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;*/&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;int rpmsg_dev_probe(struct device *dev)&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct rpmsg_device *rpdev = to_rpmsg_device(dev);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct rpmsg_driver *rpdrv = to_rpmsg_driver(rpdev-&amp;gt;dev.driver);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct rpmsg_channel_info chinfo = {};&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct rpmsg_endpoint *ept = NULL;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int err;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (rpdrv-&amp;gt;callback) {&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font color=&quot;#0000FF&quot;&gt;&lt;i&gt;/* 从rpmsg_device中提取出rpmsg channel信息，保存到rpmsg_channel_info*/&lt;/i&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; strncpy(chinfo.&lt;font color=&quot;#FF0080&quot;&gt;name&lt;/font&gt;, rpdev-&amp;gt;id.name, RPMSG_NAME_SIZE);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; chinfo.&lt;font color=&quot;#FF0080&quot;&gt;src &lt;/font&gt;= rpdev-&amp;gt;src;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; chinfo.&lt;font color=&quot;#FF0080&quot;&gt;dst &lt;/font&gt;= RPMSG_ADDR_ANY;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font color=&quot;#0000FF&quot;&gt;/* 调用rpdev-&amp;gt;ops-&amp;gt;create_ept，创建一个新的rpmsg endpoint */&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; ept = &lt;font color=&quot;#FF0080&quot;&gt;rpmsg_create_ept&lt;/font&gt;(rpdev, rpdrv-&amp;gt;callback, NULL, chinfo);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (!ept) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; dev_err(dev, &quot;failed to create endpoint\n&quot;);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; err = -ENOMEM;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; goto out;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; /*&amp;nbsp; */&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpdev-&amp;gt;ept = ept;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpdev-&amp;gt;&lt;font color=&quot;#FF0080&quot;&gt;src = ept-&amp;gt;addr&lt;/font&gt;; &lt;font color=&quot;#0000FF&quot;&gt;// src: local address&lt;/font&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font color=&quot;#0000FF&quot;&gt;/* 调用rpmsg driver的.probe函数 */&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; err = rpdrv-&amp;gt;probe(rpdev);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (err) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; dev_err(dev, &quot;%s: failed: %d\n&quot;, __func__, err);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (ept)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpmsg_destroy_ept(ept);&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; goto out;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;font color=&quot;#0000FF&quot;&gt;/* 如果有必要，可以开放这个channel给远程处理器(驱动暴露出rpmsg service的情况下需要) */&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (rpdev-&amp;gt;ops-&amp;gt;announce_create)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; err = rpdev-&amp;gt;ops-&amp;gt;announce_create(rpdev);&lt;br&gt;out:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return err;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="60" y="1300" width="610" height="820" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-222" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-182" source="Eo5dm-Wqf6loFh02fLz2-201" target="Eo5dm-Wqf6loFh02fLz2-212">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="690" y="715" />
              <mxPoint x="690" y="1080" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-223" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#FF00FF;entryX=1.016;entryY=0.524;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-182" source="Eo5dm-Wqf6loFh02fLz2-203" target="Eo5dm-Wqf6loFh02fLz2-221">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="750" y="1730" as="targetPoint" />
            <Array as="points">
              <mxPoint x="740" y="793" />
              <mxPoint x="740" y="1730" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-224" value="&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;/* rpmsg_create_ept() - create a new rpmsg_endpoint&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* &lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 系统中的每一个rpmsg address通过rpmsg_endpoint结构体，绑定到一个rx callback&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* （所以当inbound messages到达时，它们会被rpmsg bus使用适当的回调处理程序派发）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 这个函数允许驱动创建一个endpoint，它绑定一个callback和一些可能的私有数据到一个&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* rpmsg address（可以是事先知道的，也可以是动态分配的）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 简单的rpmsg driver不需要调用rpmsg_create_ept， 因为在rpmsg bus的probe函数中，已&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 经为它创建了an endpoint（使用rpmsg driver注册到rpmsg bus上时提供的rx callback）&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* &lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 因此，对于简单的rpmsg driver来说：它们已经有了一个endpoint,它们的rx callback&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 绑定到它们的rpmsg address，当相关的inbound messages到达时（即它们的dst地址等于&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* rpmsg channel的src地址）,驱动的处理程序被调用来处理它。&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* &lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 也就是说，更复杂的rpmsg driver可能确实需要分配额外的rpmsg address，并将它们绑定&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 到不同的rx callback。为了达到这个目的，这些驱动程序需要调用这个函数。&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;*&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 所以rpmsg driver应该提供它们的@rpdev channel（所以新的endpoint将属于它们的&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* channel所属的同一个remote processor），an rx callback，一个可选的Private data&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* （which is provided back when the rx callback is invoked）,以及一个它们想要&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 绑定到callbakck的address。如果@addr是&lt;font color=&quot;#FF0080&quot;&gt;RPMSG_ADDR_ANY&lt;/font&gt;，那么rpmsg_creat_ept会&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* &lt;font color=&quot;#FF0080&quot;&gt;动态地分配&lt;/font&gt;给它们一个可用的&lt;font color=&quot;#FF0080&quot;&gt;rpmsg address&lt;/font&gt;(驱动程序应该有一个非常好的理由，为什么&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;* 不总是在这里使用&lt;/font&gt;&lt;font color=&quot;#0000FF&quot;&gt;&lt;font color=&quot;#0000FF&quot;&gt;RPMSG_ADDR_ANY&lt;/font&gt;)&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000FF&quot;&gt;&amp;nbsp;*/&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;struct rpmsg_endpoint *rpmsg_create_ept(struct rpmsg_device *rpdev,&lt;/div&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; rpmsg_rx_cb_t cb, void *priv,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; struct rpmsg_channel_info chinfo)&lt;br&gt;{&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; if (WARN_ON(!rpdev))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return NULL;&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; return &lt;font color=&quot;#FF0080&quot;&gt;rpdev-&amp;gt;ops-&amp;gt;create_ept(rpdev, cb, priv, chinfo);&lt;/font&gt;&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Lucida Console;fontColor=#000000;shadow=0;labelBackgroundColor=#FFF4C3;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="790" y="1600" width="560" height="510" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-225" value="&lt;div&gt;src: local address&lt;/div&gt;&lt;div&gt;dst: destination address&lt;br&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fontFamily=Lucida Console;fontColor=#333333;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="590" y="1800" width="190" height="36" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-227" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-182" source="Eo5dm-Wqf6loFh02fLz2-219" target="Eo5dm-Wqf6loFh02fLz2-203">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-219" value="&lt;div&gt;rpmsg_driver和&lt;/div&gt;&lt;div&gt;rpmsg_device的.name匹配成功后，会调用rpmsg_bus.rpmsg_dev_probe&lt;br&gt;&lt;/div&gt;" style="shape=note;whiteSpace=wrap;html=1;size=14;verticalAlign=top;align=left;spacingTop=-6;fontFamily=Lucida Console;fontColor=#333333;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="Eo5dm-Wqf6loFh02fLz2-182">
          <mxGeometry x="-100" y="690" width="190" height="70" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-226" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.011;entryY=0.357;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="Eo5dm-Wqf6loFh02fLz2-182" source="Eo5dm-Wqf6loFh02fLz2-201" target="Eo5dm-Wqf6loFh02fLz2-219">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-196" value="&lt;div&gt;&lt;font color=&quot;#FF00FF&quot;&gt;在rpmsg_bus上注册rpmsg_driver&lt;/font&gt;&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#000000;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="Eo5dm-Wqf6loFh02fLz2-175" target="Eo5dm-Wqf6loFh02fLz2-195">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1560" y="980.0000000000002" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Eo5dm-Wqf6loFh02fLz2-217" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Lucida Console;fontColor=#FF00FF;" edge="1" parent="1" source="Eo5dm-Wqf6loFh02fLz2-150" target="Eo5dm-Wqf6loFh02fLz2-212">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1730" y="2037.0588235294117" as="targetPoint" />
            <Array as="points">
              <mxPoint x="470" y="380" />
              <mxPoint x="370" y="380" />
              <mxPoint x="370" y="840" />
              <mxPoint x="1690" y="840" />
              <mxPoint x="1690" y="1990" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
